<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì •ë°€ í™•ë¥  ë£°ë › - ìµœì¢… ìˆ˜ì •íŒ</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f4f7f6; padding: 20px; }
        .container { display: flex; gap: 30px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); flex-wrap: wrap; justify-content: center; }
        
        /* ë£°ë › ë””ìì¸ */
        .roulette-box { position: relative; width: 400px; height: 400px; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 6px solid #333; transition: transform 4s cubic-bezier(0.1, 0, 0.2, 1); }
        .arrow { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 35px solid #e74c3c; z-index: 10; }
        
        /* ì»¨íŠ¸ë¡¤ ë””ìì¸ */
        .controls { width: 320px; }
        .item { display: flex; gap: 5px; margin-bottom: 8px; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .name { flex: 2; }
        .weight { flex: 1; text-align: center; }
        
        button { cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
        .btn-spin { background: #3498db; color: white; width: 100%; padding: 15px; font-size: 1.2rem; margin-top: 20px; }
        .btn-add { background: #2ecc71; color: white; width: 100%; padding: 10px; margin-bottom: 15px; }
        .btn-delete { background: #ff7675; color: white; padding: 5px 10px; }

        #result-text { margin-top: 25px; font-size: 1.6rem; font-weight: 800; color: #2d3436; text-align: center; min-height: 40px; }
    </style>
</head>
<body>

    <h1>ğŸ¯ ì •ë°€ í™•ë¥  ë£°ë ›</h1>

    <div class="container">
        <div class="roulette-box">
            <div class="arrow"></div>
            <canvas id="canvas" width="800" height="800"></canvas>
            <button class="btn-spin" id="spinBtn" onclick="spin()">ëŒë¦¬ê¸°!</button>
            <div id="result-text">í•­ëª©ì„ ì •í•˜ê³  ëŒë ¤ë³´ì„¸ìš”!</div>
        </div>

        <div class="controls">
            <h3>í•­ëª© ë° ê°€ì¤‘ì¹˜</h3>
            <div id="list"></div>
            <button class="btn-add" onclick="addItem()">+ í•­ëª© ì¶”ê°€</button>
            <p style="font-size: 0.85rem; color: #7f8c8d;">â€» ê°€ì¤‘ì¹˜ê°€ í´ìˆ˜ë¡ ë‹¹ì²¨ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const listDiv = document.getElementById('list');
        
        let items = [
            { name: "ë‹¹ì²¨", weight: 1, color: "#ff7675" },
            { name: "ê½", weight: 5, color: "#74b9ff" },
            { name: "ì•„ì°¨ìƒ", weight: 2, color: "#55efc4" }
        ];

        let totalRotation = 0;

        function draw() {
            const totalWeight = items.reduce((s, i) => s + i.weight, 0);
            let startAngle = 0;

            ctx.clearRect(0, 0, 800, 800);

            items.forEach((item) => {
                const sliceAngle = (item.weight / totalWeight) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(400, 400);
                ctx.arc(400, 400, 380, startAngle, startAngle + sliceAngle);
                ctx.fill();
                ctx.stroke();

                // í…ìŠ¤íŠ¸ ì¶œë ¥
                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#fff";
                ctx.font = "bold 35px Arial";
                const p = ((item.weight / totalWeight) * 100).toFixed(1);
                ctx.fillText(`${item.name} ${p}%`, 360, 10);
                ctx.restore();

                startAngle += sliceAngle;
            });
        }

        function render() {
            listDiv.innerHTML = '';
            items.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <input type="text" class="name" value="${item.name}" oninput="items[i].name=this.value; draw();">
                    <input type="number" class="weight" value="${item.weight}" oninput="items[i].weight=Number(this.value); draw();">
                    <button class="btn-delete" onclick="items.splice(${i},1); render(); draw();">X</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function addItem() {
            const colors = ["#ff7675", "#74b9ff", "#55efc4", "#ffeaa7", "#a29bfe", "#fab1a0"];
            items.push({ name: "ìƒˆ í•­ëª©", weight: 1, color: colors[items.length % colors.length] });
            render();
            draw();
        }

        function spin() {
            const btn = document.getElementById('spinBtn');
            const res = document.getElementById('result-text');
            btn.disabled = true;
            res.innerText = "íšŒì „ ì¤‘...";

            const totalWeight = items.reduce((s, i) => s + i.weight, 0);
            
            // 1. ìµœì†Œ 5ë°”í€´ ì´ìƒ íšŒì „ + ëœë¤ ê°ë„
            const additionalDeg = Math.floor(Math.random() * 360);
            totalRotation += (360 * 5) + additionalDeg;
            
            canvas.style.transform = `rotate(${totalRotation}deg)`;

            setTimeout(() => {
                btn.disabled = false;
                
                // 2. ê²°ê³¼ ê³„ì‚° (í•µì‹¬ ë³´ì •)
                // í˜„ì¬ ìº”ë²„ìŠ¤ì˜ ì‹¤ì œ íšŒì „ ê°ë„ë¥¼ 360ë„ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€
                const currentDeg = totalRotation % 360;
                
                // ë°”ëŠ˜ì€ 12ì‹œ(-90ë„)ì— ê³ ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, 
                // ì „ì²´ì—ì„œ íšŒì „ëœ ê°ë„ë¥¼ ë¹¼ê³  12ì‹œ ë°©í–¥ì¸ 270ë„(ë˜ëŠ” -90ë„)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³´ì •í•©ë‹ˆë‹¤.
                let winAngle = (360 - currentDeg - 90) % 360;
                if (winAngle < 0) winAngle += 360;

                let currentUpper = 0;
                let winner = "";

                for (let item of items) {
                    const itemDeg = (item.weight / totalWeight) * 360;
                    if (winAngle >= currentUpper && winAngle < currentUpper + itemDeg) {
                        winner = item.name;
                        break;
                    }
                    currentUpper += itemDeg;
                }
                res.innerText = `ê²°ê³¼: [${winner}]`;
            }, 4000);
        }

        render();
        draw();
    </script>
</body>
</html>
