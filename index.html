<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì‹œê°„ í™•ë¥  ë°˜ì˜ ë£°ë ›</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; padding: 20px; }
        .container { display: flex; gap: 40px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); flex-wrap: wrap; justify-content: center; }
        
        /* ë£°ë › ìŠ¤íƒ€ì¼ */
        .roulette-box { position: relative; width: 420px; height: 420px; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #333; transition: transform 4s cubic-bezier(0.1, 0, 0.2, 1); background: white; }
        .arrow { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid #ff4757; z-index: 10; }
        
        /* ì„¤ì •ì°½ ìŠ¤íƒ€ì¼ */
        .controls { width: 350px; }
        .item-row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .name-input { flex: 2; font-weight: bold; }
        .weight-input { flex: 1; text-align: center; color: #0984e3; font-weight: bold; }
        
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-spin { background: #0984e3; color: white; width: 100%; padding: 18px; font-size: 1.2rem; margin-top: 20px; }
        .btn-add { background: #00b894; color: white; width: 100%; padding: 12px; margin-bottom: 20px; }
        .btn-remove { background: #fab1a0; color: #d63031; padding: 8px 12px; }
        
        #result-display { margin-top: 25px; font-size: 1.8rem; font-weight: 800; color: #2d3436; text-align: center; height: 40px; }
        .prob-info { font-size: 0.9rem; color: #636e72; background: #dfe6e9; padding: 10px; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ¡ ì‹¤ì‹œê°„ ì •ë°€ í™•ë¥  ë£°ë ›</h1>

    <div class="container">
        <div class="roulette-box">
            <div class="arrow"></div>
            <canvas id="canvas" width="800" height="800"></canvas>
            <button class="btn-spin" id="spinBtn" onclick="spin()">ë£°ë › ëŒë¦¬ê¸°!</button>
            <div id="result-display">ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>

        <div class="controls">
            <h3>ğŸ“Š í•­ëª© ë° í™•ë¥  ì„¤ì •</h3>
            <div id="item-list"></div>
            <button class="btn-add" onclick="addItem()">+ í•­ëª© ì¶”ê°€</button>
            <div class="prob-info">
                ğŸ’¡ <b>ê°€ì¤‘ì¹˜(ì˜¤ë¥¸ìª½ ìˆ«ì)</b>ë¥¼ ìˆ˜ì •í•´ ë³´ì„¸ìš”!<br>
                ìˆ«ìë¥¼ í‚¤ìš°ë©´ í•´ë‹¹ ì¹¸ì´ ì¦‰ì‹œ ì»¤ì§‘ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let items = [
            { name: "ë‹¹ì²¨", weight: 1, color: "#ff7675" },
            { name: "ê½", weight: 3, color: "#74b9ff" },
            { name: "ì¬ë„ì „", weight: 2, color: "#55efc4" }
        ];
        let currentRotation = 0;

        // ë£°ë › ê·¸ë¦¬ê¸° í•¨ìˆ˜ (ì¤‘ìš”: ê°€ì¤‘ì¹˜ ë³€í™”ë¥¼ ì¦‰ì‹œ ë°˜ì˜)
        function draw() {
            const totalWeight = items.reduce((sum, item) => sum + (Number(item.weight) || 0), 0);
            if (totalWeight <= 0) return;

            let startAngle = 0;
            ctx.clearRect(0, 0, 800, 800);

            items.forEach((item) => {
                const sliceAngle = (item.weight / totalWeight) * 2 * Math.PI;
                
                // ì¡°ê° ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(400, 400);
                ctx.arc(400, 400, 380, startAngle, startAngle + sliceAngle);
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 3;
                ctx.stroke();

                // í…ìŠ¤íŠ¸ ë° í™•ë¥  í‘œì‹œ
                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 32px Arial";
                
                const percent = ((item.weight / totalWeight) * 100).toFixed(1);
                // ì¹¸ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ ì´ë¦„ë§Œ í‘œì‹œ
                const label = sliceAngle > 0.15 ? `${item.name} (${percent}%)` : "";
                ctx.fillText(label, 350, 10);
                ctx.restore();

                startAngle += sliceAngle;
            });
        }

        // ì„¤ì •ì°½ ëª©ë¡ ë Œë”ë§
        function renderSettings() {
            const container = document.getElementById('item-list');
            container.innerHTML = '';
            
            items.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.innerHTML = `
                    <input type="text" class="name-input" value="${item.name}" 
                        oninput="items[${i}].name=this.value; draw();">
                    <input type="number" class="weight-input" value="${item.weight}" min="0"
                        oninput="items[${i}].weight=Number(this.value); draw();">
                    <button class="btn-remove" onclick="removeItem(${i})">ì‚­ì œ</button>
                `;
                container.appendChild(div);
            });
        }

        function addItem() {
            const colors = ["#ff7675", "#74b9ff", "#55efc4", "#ffeaa7", "#a29bfe", "#fd79a8", "#fab1a0"];
            items.push({ 
                name: "ìƒˆ í•­ëª©", 
                weight: 1, 
                color: colors[items.length % colors.length] 
            });
            renderSettings();
            draw();
        }

        function removeItem(index) {
            if (items.length > 1) {
                items.splice(index, 1);
                renderSettings();
                draw();
            }
        }

        function spin() {
            const btn = document.getElementById('spinBtn');
            const resultDisplay = document.getElementById('result-display');
            btn.disabled = true;
            resultDisplay.innerText = "ë‘êµ¬ë‘êµ¬ë‘êµ¬...";

            const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
            const randomAdd = Math.floor(Math.random() * 360);
            currentRotation += (360 * 10) + randomAdd; // 10ë°”í€´ + ëœë¤

            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                btn.disabled = false;
                
                // ê²°ê³¼ ê³„ì‚° ë³´ì • (12ì‹œ í™”ì‚´í‘œ ë°©í–¥)
                const actualDeg = currentRotation % 360;
                let winAngle = (360 - (actualDeg - 90)) % 360;
                if (winAngle < 0) winAngle += 360;

                let currentUpper = 0;
                let winner = "";

                for (let item of items) {
                    const itemDeg = (item.weight / totalWeight) * 360;
                    if (winAngle >= currentUpper && winAngle < currentUpper + itemDeg) {
                        winner = item.name;
                        break;
                    }
                    currentUpper += itemDeg;
                }
                resultDisplay.innerText = `ğŸ‰ ê²°ê³¼: [${winner}]`;
            }, 4000);
        }

        // ì´ˆê¸° ì‹¤í–‰
        renderSettings();
        draw();
    </script>
</body>
</html>
