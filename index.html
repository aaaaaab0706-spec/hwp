<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë°€ í™•ë¥  ë£°ë › - ìµœì¢… ìˆ˜ì • ì™„ë£Œ</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; display: flex; flex-direction: column; align-items: center; background: #f8f9fa; padding: 20px; }
        .container { display: flex; gap: 30px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); flex-wrap: wrap; justify-content: center; max-width: 900px; }
        .roulette-box { position: relative; width: 380px; height: 380px; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 6px solid #333; transition: transform 4s cubic-bezier(0.1, 0, 0.2, 1); }
        /* ë¹¨ê°„ í™”ì‚´í‘œê°€ 12ì‹œ ì •ì¤‘ì•™ì— ìœ„ì¹˜ */
        .arrow { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #ff4757; z-index: 10; }
        .controls { width: 320px; }
        .item-row { display: flex; gap: 5px; margin-bottom: 10px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .name-input { flex: 2; }
        .weight-input { flex: 1; text-align: center; font-weight: bold; color: #0984e3; }
        button { cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
        .btn-spin { background: #0984e3; color: white; width: 100%; padding: 15px; font-size: 1.1rem; margin-top: 20px; }
        .btn-add { background: #00b894; color: white; width: 100%; padding: 10px; margin-bottom: 15px; }
        .btn-remove { background: #ff7675; color: white; padding: 5px 10px; }
        #result-text { margin-top: 20px; font-size: 1.5rem; font-weight: 800; text-align: center; min-height: 40px; color: #2d3436; }
    </style>
</head>
<body>

    <h2>ğŸ¡ ê²°ê³¼ ì¼ì¹˜ ë£°ë › (ìµœì¢… ë¬¼ë¦¬ ë³´ì •)</h2>

    <div class="container">
        <div class="roulette-box">
            <div class="arrow"></div>
            <canvas id="canvas" width="800" height="800"></canvas>
            <button class="btn-spin" id="spinBtn" onclick="spin()">ëŒë¦¬ê¸°!</button>
            <div id="result-text">ê°€ì¤‘ì¹˜ë¥¼ ì…ë ¥í•´ ë³´ì„¸ìš”!</div>
        </div>

        <div class="controls">
            <h3>í•­ëª© ë° ê°€ì¤‘ì¹˜ ì„¤ì •</h3>
            <div id="item-list"></div>
            <button class="btn-add" onclick="addItem()">+ í•­ëª© ì¶”ê°€</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let items = [
            { name: "ê½", weight: 4, color: "#74b9ff" },
            { name: "ì•„ì°¨ìƒ", weight: 6, color: "#55efc4" },
            { name: "ìƒˆ í•­ëª©1", weight: 5, color: "#ffeaa7" },
            { name: "ìƒˆ í•­ëª©2", weight: 5, color: "#ff7675" }
        ];
        let currentRotation = 0;

        function draw() {
            const totalWeight = items.reduce((sum, item) => sum + (parseFloat(item.weight) || 0), 0);
            ctx.clearRect(0, 0, 800, 800);
            if (totalWeight <= 0) return;

            let startAngle = 0;
            items.forEach((item) => {
                const weightValue = parseFloat(item.weight) || 0;
                const sliceAngle = (weightValue / totalWeight) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.fillStyle = item.color;
                ctx.moveTo(400, 400);
                // ìº”ë²„ìŠ¤ ê¸°ë³¸ ì‹œì‘ì (3ì‹œ)ì„ 12ì‹œë¡œ ë§ì¶”ê¸° ìœ„í•´ ì „ì²´ë¥¼ -90ë„(-PI/2)ë¶€í„° ê·¸ë¦½ë‹ˆë‹¤.
                const offset = -Math.PI / 2;
                ctx.arc(400, 400, 380, startAngle + offset, startAngle + sliceAngle + offset);
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(startAngle + sliceAngle / 2 + offset);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 30px Arial";
                const percent = ((weightValue / totalWeight) * 100).toFixed(1);
                if (sliceAngle > 0.1) ctx.fillText(`${item.name} ${percent}%`, 350, 10);
                ctx.restore();

                startAngle += sliceAngle;
            });
        }

        function renderSettings() {
            const list = document.getElementById('item-list');
            list.innerHTML = '';
            items.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.innerHTML = `
                    <input type="text" class="name-input" value="${item.name}" oninput="updateData(${i}, 'name', this.value)">
                    <input type="number" class="weight-input" value="${item.weight}" oninput="updateData(${i}, 'weight', this.value)">
                    <button class="btn-remove" onclick="removeItem(${i})">X</button>
                `;
                list.appendChild(div);
            });
        }

        function updateData(index, field, value) {
            items[index][field] = field === 'weight' ? (parseFloat(value) || 0) : value;
            draw();
        }

        function addItem() {
            const colors = ["#ff7675", "#74b9ff", "#55efc4", "#ffeaa7", "#a29bfe", "#fd79a8"];
            items.push({ name: "ìƒˆ í•­ëª©", weight: 5, color: colors[items.length % colors.length] });
            renderSettings();
            draw();
        }

        function removeItem(index) {
            if (items.length > 1) {
                items.splice(index, 1);
                renderSettings();
                draw();
            }
        }

        function spin() {
            const btn = document.getElementById('spinBtn');
            const res = document.getElementById('result-text');
            const totalWeight = items.reduce((sum, item) => sum + (parseFloat(item.weight) || 0), 0);
            
            if (totalWeight <= 0) return alert("ê°€ì¤‘ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            btn.disabled = true;
            res.innerText = "íšŒì „ ì¤‘...";

            const randomDeg = Math.floor(Math.random() * 360);
            currentRotation += (360 * 8) + randomDeg;
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                btn.disabled = false;
                
                // --- í•µì‹¬ ë³´ì •: ë£°ë ›íŒì˜ ì‹œê°ì  ìœ„ì¹˜ì™€ ë¡œì§ì˜ ì¼ì¹˜ ---
                // íŒì´ ì‹œê³„ë°©í–¥(+)ìœ¼ë¡œ ëŒì•„ê°€ë©´, ë°”ëŠ˜ì´ ê°€ë¦¬í‚¤ëŠ” ì§€ì ì€ ë°˜ì‹œê³„ë°©í–¥(-)ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
                const actualDeg = currentRotation % 360;
                let winAngle = (360 - actualDeg) % 360;

                let currentUpper = 0;
                let winner = "ì˜¤ë¥˜";
                for (let item of items) {
                    const itemDeg = (parseFloat(item.weight) / totalWeight) * 360;
                    // ê° í•­ëª©ì˜ ë²”ìœ„ë¥¼ ì²´í¬ (ì‘ì€ ì˜¤ì°¨ ë³´ì •ì„ ìœ„í•´ +0.01)
                    if (winAngle >= currentUpper - 0.01 && winAngle < currentUpper + itemDeg) {
                        winner = item.name;
                        break;
                    }
                    currentUpper += itemDeg;
                }
                res.innerText = `ğŸ‰ ê²°ê³¼: [${winner}]`;
            }, 4000);
        }

        renderSettings();
        draw();
    </script>
</body>
</html>
